@page "/"
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@using Imc.Components

<form onsubmit="@EnviarFormulario">
    <div class="container">
        <Imc.Components.Title Text="Cálculo de IMC"/>

        <div class="input-align">
            <input class="input" type="text" placeholder="Altura" @bind="Height" >
        </div>
        <div class="input-align">
            <input class="input" type="text" placeholder="Peso" @bind="Weight" >
        </div>
        <div class="input-align">
            <input class="input" type="text" placeholder="Sexo" @bind="Gender" >
        </div>
       
        @*         
            <Imc.Components.InputText @bind-Value="@Altura" PlaceHolder="Height"/>
            <Imc.Components.InputText @bind-Value="@Peso" PlaceHolder="Weight"/>
            <Imc.Components.InputText @bind-Value="@Sexo" PlaceHolder="Gender"/> 
        *@
        
        <Checkbox Name="isSeniorCitizen" Value="Eu tenho 65 anos ou mais!"/>
        <ButtonSubmitCustom Value="Calcular meu IMC" Type="submit"/>
        <ButtonSubmitCustom Value="Entenda seu cálculo" Type="primary"/>
    </div>
</form>

@code {
    public string Height { get; set; } 
    public string Weight { get; set; }
    public string Gender { get; set; }

    public async Task EnviarFormulario()
    {
        double.TryParse(Weight, out var weight);
        double.TryParse(Height, out var height);
        double imc = weight / (height * height);
        var date = DateTime.Now;
        
        var normal = false;
        if(imc <=  24.9)
            normal = true;

        var savedList = await localStorage.GetItemAsync<List<Result>>("list-imc");
        var result = new Result(normal, date);
        
        if(savedList == null || !savedList.Any())
            savedList = new List<Result>();
        
        savedList.Add(result);
        await localStorage.SetItemAsync("list-imc", savedList);
    }

    public class Result
    {
        public bool Normal { get; set; }
        public DateTime Date { get; set; }

        public Result(bool normal, DateTime date){
            Normal = normal;
            Date = date;
        }
    }
}